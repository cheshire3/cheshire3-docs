<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <title>Cheshire3 Objects: DocumentFactory</title>
        <link rel="stylesheet" type="text/css" href="http://www.cheshire3.org/cheshire3.css"></link>
    </head>
    <body>
        <table cellpadding="0" cellspacing="0" class="maintitle">
            <tr>
                <td class="cheshirelogo">
                    <img src="http://www.cheshire3.org/gfx/c3_white.gif"/>
                </td>
                <td>
                    <img src="http://www.cheshire3.org/gfx/slant_grey.gif"/>
                </td>
                <td align="center">
                    <h2>Cheshire3 Objects:  DocumentFactory</h2>
                </td>
            </tr>
	</table>

	<!--#config errmsg="<div id="navbar"/>" -->
	<!--#include virtual="/navbar.ssi" -->

	<div class="fieldset">
            <span class="legend">Description</span>
            <p>
                DocumentFactories are the main means by which <a href="object_document.html">Documents</a> are ingested into the system.
                
                Once the 'load' argument has been called, a DocumentFactory should be able to return, on request, one or more Documents.
                The way in which it does this will depend on the way in which it has been configured, and how 'load' was called.
                For example it may locate all documents, and cache them internally (e.g. for multiple XML documents within a single file), or it may crawl, locating and returning the documents one at a time (e.g. for many large files in a directory structure.)
            </p>
	</div>

        <div class="fieldset">
            <span class="legend">Implementations</span>
            <ul>
                <li>
                    <b>documentFactory.SimpleDocumentFactory</b> <br/>
                    A 'Smart' DocumentFactory that will attempt to do the most sensible thing to generate documents, based on what is passed to its 'load' method.
                    It does this by calling an appropriate DocumentStream.
                    <a href="#capabilities">Classes of DocumentStream</a> implemented at the present time are listed below for reference.
                </li>
                <li>
                    <b>documentFactory.ComponentDocumentFactory</b> <br/>
                    A ComponentDocumentFactory is configured ahead of time with an XPath. 
                    When its 'load' method is called on a <a href="object_record.html">Record</a>, the record is processed, and elements matching the configured XPath are extracted and treated as new documents in their own right.
                </li>
                <li>
                    <b>documentFactory.AccumulatingDocumentFactory</b> <br/>
                    [docs coming soon]
                </li>
            <ul>
        </div>
                
        <a name="capabilities"></a>
        <div class="fieldset">
            <span class="legend">Capabilities</span>
            <p>
                At the present time, the following DocumentStreams are available for use by DocumentFactories. <br/>
                <b>Note Well</b>: these are only intended for use by DocumentFactories, and are unlikely to behave correctly if called directly by users' script.
            </p>
            <ul>
                <li>
                    <b>documentFactory.FileDocumentStream</b> <br/>
                    Given the path to a file, find XML documents in it and read them into memory.
                </li>
                <li>
                    <b>documentFactory.BigFileDocumentStream</b> <br/>
                    Given the path to a file, find XML documents in it, but only retrieve them on request.
                </li>
                <li>
                    <b>documentFactory.TarDocumentStream</b> <br/>
                    Given the data which makes up a tar file, extract the files from it as Documents.
                </li>
                <li>
                    <b>documentFactory.TarFileDocumentStream</b> <br/>
                    Given a path to a tar file, extract the files from it as Documents.
                </li>
                <li>
                    <b>documentFactory.ZipDocumentStream</b> <br/>
                    Given the data which makes up a zip file, extract the files from it as Documents.
                </li>
                <li>
                    <b>documentFactory.ZipFileDocumentStream</b> <br/>
                    Given a path to a zip file, extract the files from it as Documents.
                </li>
                <li>
                    <b>documentFactory.ClusterFileDocumentStream</b> <br/>
                    Given the path to a raw cluster data file, merge and create documents.
                </li>
                <li>
                    <b>documentFactory.MarcFileDocumentStream</b> <br/>
                    Given the path to a file containing MARC records, extract them.
                </li>
                <li>
                    <b>documentFactory.BigMarcFileDocumentStream</b> <br/>
                    Given the path to a file containing MARC records, locate them, but only read into memory as requested.
                </li>
                <li>
                    <b>documentFactory.Z3950SearchDocumentStream</b><br/>
                    Given a tuple of (Zoom Connection, Zoom Query), perform the search and then map the results to Documents.
                </li>
                <li>
                    <b>documentFactory.SRWSearchDocumentStream</b><br/>
                    Given a tuple of (URL, {args}) turn the arguments (ala SRU) into an SRW request, perform it, and map the results to Documents.
                </li>
                <li>
                    <b>documentFactory.OAIHarvestDocumentStream</b><br/>
                    Given a tuple of (URL, {args}) turn the arguments into the parameters for OAI, and harvest the records from the URL, mapping them to Documents.
                </li>
                <li>
                    <del><b>documentFactory.GoogleSearchDocumentStream</b> <br/>
                    Given a Google query, use the Google SOAP interface to search, fetch the actual files matched and map them to documents.
                    </del> <br/>
                    <b>OBSELETE</b> - Google have withdrawn their SOAP interface.
                </li>
            </ul>
        </div>

	<div class="fieldset">
            <span class="legend">API</span>
            <table border="1" cellpadding="3" cellspacing="0" width="100%">
                <tr><th>Function</th><th>Parameters</th><th>Returns</th><th>Description</th></tr>
                <tr><td>__init__</td><td>session, config, parent</td><td>&#160;</td><td>The constructer takes the config node for the object, and its parent (usually a database).</td></tr>
                <tr>
                    <td>load</td>
                    <td>session, ?data, ?cache, ?format, ?tagName, ?codec</td>
                    <td>&#160;</td>
                    <td>Load the data provide (or use the configured default if not provided). The way the data is loaded is dependent on the other parameters (or their configured defaults if absent):
                        <ul>
                            <li><i>cache</i> - should documents be cached in memory: 0 = No, 1 = Locations cached but not documents, 2 = Yes</li>
                            <li><i>format</i> - specifies how to treat the data parameter</li>
                            <li><i>tagName</i> - The XML tag to treat as the document root</li>
                            <li><i>codec</i> - specifies the codec to use to read the documents in</li>
                        </ul>
                    </td></tr>
                <tr><td>get_document</td><td>session, ?index</td><td>Document</td><td>Return the index'th document in the factory if index is provided, otherwise return the next document.</td></tr>
                <tr><td>register_stream</td><td>session, format, class</td><td>&#160;</td><td>Register the supplied class of DocumentStream with the document factory for the given format. This class will be used the next time 'load' is called with this format.</td></tr>
            </table>
            <br/>
	</div>

    </body>
</html>
